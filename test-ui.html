<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>1TaskAssistant - Model Testing UI</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
            background-color: #f5f5f5;
            padding: 20px;
            line-height: 1.6;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            overflow: hidden;
        }

        .header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 20px;
            text-align: center;
        }

        .tabs {
            display: flex;
            background-color: #f8f9fa;
            border-bottom: 1px solid #dee2e6;
        }

        .tab {
            flex: 1;
            padding: 15px;
            background: none;
            border: none;
            cursor: pointer;
            font-size: 14px;
            font-weight: 500;
            color: #6c757d;
            transition: all 0.3s ease;
        }

        .tab:hover {
            background-color: #e9ecef;
        }

        .tab.active {
            background-color: white;
            color: #495057;
            border-bottom: 2px solid #667eea;
        }

        .tab-content {
            display: none;
            padding: 20px;
        }

        .tab-content.active {
            display: block;
        }

        .form-group {
            margin-bottom: 15px;
        }

        .form-row {
            display: flex;
            gap: 15px;
            align-items: end;
        }

        .form-row .form-group {
            flex: 1;
        }

        label {
            display: block;
            margin-bottom: 5px;
            font-weight: 500;
            color: #495057;
        }

        input, select, textarea {
            width: 100%;
            padding: 8px 12px;
            border: 1px solid #ced4da;
            border-radius: 4px;
            font-size: 14px;
            transition: border-color 0.3s ease;
        }

        input:focus, select:focus, textarea:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 2px rgba(102, 126, 234, 0.2);
        }

        textarea {
            resize: vertical;
            min-height: 80px;
        }

        button {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 500;
            transition: all 0.3s ease;
        }

        button:hover {
            transform: translateY(-1px);
            box-shadow: 0 4px 12px rgba(102, 126, 234, 0.3);
        }

        button:disabled {
            background: #6c757d;
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }

        .btn-secondary {
            background: #6c757d;
            margin-left: 10px;
        }

        .btn-danger {
            background: #dc3545;
        }

        .result {
            margin-top: 20px;
            padding: 15px;
            border-radius: 4px;
            border-left: 4px solid #667eea;
            background-color: #f8f9fa;
            font-family: 'Monaco', 'Menlo', 'Ubuntu Mono', monospace;
            font-size: 12px;
            white-space: pre-wrap;
            max-height: 400px;
            overflow-y: auto;
        }

        .result.error {
            border-left-color: #dc3545;
            background-color: #f8d7da;
            color: #721c24;
        }

        .result.success {
            border-left-color: #28a745;
            background-color: #d4edda;
            color: #155724;
        }

        .api-status {
            display: inline-block;
            padding: 4px 8px;
            border-radius: 12px;
            font-size: 12px;
            font-weight: 500;
            margin-left: 10px;
        }

        .api-status.online {
            background-color: #d4edda;
            color: #155724;
        }

        .api-status.offline {
            background-color: #f8d7da;
            color: #721c24;
        }

        .cards {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }

        .card {
            background: white;
            border-radius: 8px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
            padding: 20px;
            border-left: 4px solid #667eea;
        }

        .card h3 {
            margin-bottom: 15px;
            color: #495057;
        }

        .tags {
            display: flex;
            flex-wrap: wrap;
            gap: 5px;
            margin-top: 10px;
        }

        .tag {
            background-color: #e9ecef;
            padding: 2px 8px;
            border-radius: 12px;
            font-size: 12px;
            color: #6c757d;
        }

        .loading {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid #f3f3f3;
            border-top: 3px solid #667eea;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        /* Additional styles for enhanced UI */
        .card-actions {
            position: absolute;
            top: 15px;
            right: 15px;
            display: flex;
            gap: 5px;
        }

        .card-actions button {
            padding: 4px 8px;
            font-size: 12px;
            border-radius: 3px;
        }

        .btn-edit {
            background: #28a745;
        }

        .btn-delete {
            background: #dc3545;
        }

        .table-container {
            margin-top: 20px;
            overflow-x: auto;
        }

        table {
            width: 100%;
            border-collapse: collapse;
            background: white;
            border-radius: 6px;
            overflow: hidden;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
        }

        th, td {
            padding: 12px;
            text-align: left;
            border-bottom: 1px solid #e9ecef;
            font-size: 14px;
        }

        th {
            background: #f8f9fa;
            font-weight: 600;
            color: #495057;
        }

        tr:hover {
            background: #f8f9fa;
        }

        .empty-state {
            text-align: center;
            color: #6c757d;
            padding: 40px;
            font-style: italic;
        }

        .card {
            position: relative;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>🎯 1TaskAssistant Model Testing UI</h1>
            <p>Test your comprehensive productivity system models</p>
            <span id="apiStatus" class="api-status offline">API Offline</span>
        </div>

        <div class="tabs">
            <button class="tab active" onclick="showTab('tasks')">Tasks</button>
            <button class="tab" onclick="showTab('yearly-goals')">Yearly Goals</button>
            <button class="tab" onclick="showTab('quarterly-goals')">Quarterly Goals</button>
            <button class="tab" onclick="showTab('weekly-goals')">Weekly Goals</button>
            <button class="tab" onclick="showTab('habits')">Habits</button>
            <button class="tab" onclick="showTab('projects')">Projects</button>
        </div>

        <!-- Tasks Tab -->
        <div id="tasks" class="tab-content active">
            <h2>✅ Tasks</h2>
            <form id="taskForm">
                <div class="form-row">
                    <div class="form-group">
                        <label for="taskTitle">Title *</label>
                        <input type="text" id="taskTitle" required>
                    </div>
                    <div class="form-group">
                        <label for="taskPriority">Priority</label>
                        <select id="taskPriority">
                            <option value="low">Low</option>
                            <option value="medium" selected>Medium</option>
                            <option value="high">High</option>
                            <option value="urgent">Urgent</option>
                        </select>
                    </div>
                </div>
                
                <div class="form-group">
                    <label for="taskDescription">Description</label>
                    <textarea id="taskDescription"></textarea>
                </div>
                
                <div class="form-row">
                    <div class="form-group">
                        <label for="taskDueDate">Due Date</label>
                        <input type="datetime-local" id="taskDueDate">
                    </div>
                    <div class="form-group">
                        <label for="taskEstimatedHours">Estimated Hours</label>
                        <input type="number" id="taskEstimatedHours" step="0.5" min="0">
                    </div>
                </div>
                
                <div class="form-row">
                    <div class="form-group">
                        <label for="taskProjectId">Project</label>
                        <select id="taskProjectId">
                            <option value="">No Project</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="taskWeeklyGoalId">Weekly Goal</label>
                        <select id="taskWeeklyGoalId">
                            <option value="">No Weekly Goal</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="taskHabitId">Habit</label>
                        <select id="taskHabitId">
                            <option value="">No Habit</option>
                        </select>
                    </div>
                </div>
                
                <div class="form-group">
                    <label for="taskTags">Tags (comma-separated)</label>
                    <input type="text" id="taskTags" placeholder="work, urgent, development">
                </div>
                
                <div class="form-group">
                    <label for="taskUserId">User ID *</label>
                    <input type="text" id="taskUserId" value="test-user-ui" required>
                </div>
                
                <button type="submit">Create Task</button>
                <button type="button" class="btn-secondary" onclick="loadTasks()">Load Tasks</button>
                <button type="button" class="btn-secondary" onclick="clearForm('taskForm')">Clear</button>
            </form>
            
            <div id="taskResult" class="result" style="display: none;"></div>
            
            <div class="table-container">
                <h3>📋 Tasks</h3>
                <div id="tasksTable"></div>
            </div>
        </div>

        <!-- Yearly Goals Tab -->
        <div id="yearly-goals" class="tab-content">
            <h2>🎯 Yearly Goals</h2>
            <form id="yearlyGoalForm">
                <div class="form-row">
                    <div class="form-group">
                        <label for="yearlyGoalTitle">Title *</label>
                        <input type="text" id="yearlyGoalTitle" required>
                    </div>
                    <div class="form-group">
                        <label for="yearlyGoalYear">Target Year *</label>
                        <input type="number" id="yearlyGoalYear" value="2025" required>
                    </div>
                </div>
                
                <div class="form-group">
                    <label for="yearlyGoalDescription">Description</label>
                    <textarea id="yearlyGoalDescription"></textarea>
                </div>
                
                <div class="form-group">
                    <label for="yearlyGoalMetrics">Key Metrics (comma-separated)</label>
                    <input type="text" id="yearlyGoalMetrics" placeholder="Complete 10 projects, Learn 5 technologies">
                </div>
                
                <div class="form-group">
                    <label for="yearlyGoalUserId">User ID *</label>
                    <input type="text" id="yearlyGoalUserId" value="test-user-ui" required>
                </div>
                
                <button type="submit">Create Yearly Goal</button>
                <button type="button" class="btn-secondary" onclick="loadYearlyGoals()">Load Goals</button>
                <button type="button" class="btn-secondary" onclick="clearForm('yearlyGoalForm')">Clear</button>
            </form>
            
            <div id="yearlyGoalResult" class="result" style="display: none;"></div>
            
            <div class="table-container">
                <h3>🎯 Yearly Goals</h3>
                <div id="yearlyGoalsTable"></div>
            </div>
        </div>

        <!-- Quarterly Goals Tab -->
        <div id="quarterly-goals" class="tab-content">
            <h2>📅 Quarterly Goals</h2>
            <form id="quarterlyGoalForm">
                <div class="form-row">
                    <div class="form-group">
                        <label for="quarterlyGoalTitle">Title *</label>
                        <input type="text" id="quarterlyGoalTitle" required>
                    </div>
                    <div class="form-group">
                        <label for="quarterlyGoalYear">Target Year *</label>
                        <input type="number" id="quarterlyGoalYear" value="2025" required>
                    </div>
                    <div class="form-group">
                        <label for="quarterlyGoalQuarter">Quarter *</label>
                        <select id="quarterlyGoalQuarter" required>
                            <option value="1">Q1</option>
                            <option value="2">Q2</option>
                            <option value="3">Q3</option>
                            <option value="4">Q4</option>
                        </select>
                    </div>
                </div>
                
                <div class="form-group">
                    <label for="quarterlyGoalDescription">Description</label>
                    <textarea id="quarterlyGoalDescription"></textarea>
                </div>
                
                <div class="form-row">
                    <div class="form-group">
                        <label for="quarterlyGoalMetrics">Key Metrics (comma-separated)</label>
                        <input type="text" id="quarterlyGoalMetrics">
                    </div>
                    <div class="form-group">
                        <label for="quarterlyGoalYearlyId">Yearly Goal ID</label>
                        <input type="text" id="quarterlyGoalYearlyId" placeholder="Optional">
                    </div>
                </div>
                
                <div class="form-group">
                    <label for="quarterlyGoalUserId">User ID *</label>
                    <input type="text" id="quarterlyGoalUserId" value="test-user-ui" required>
                </div>
                
                <button type="submit">Create Quarterly Goal</button>
                <button type="button" class="btn-secondary" onclick="clearForm('quarterlyGoalForm')">Clear</button>
            </form>
            
                <button type="submit">Create Quarterly Goal</button>
                <button type="button" class="btn-secondary" onclick="loadQuarterlyGoals()">Load Goals</button>
                <button type="button" class="btn-secondary" onclick="clearForm('quarterlyGoalForm')">Clear</button>
            </form>
            
            <div id="quarterlyGoalResult" class="result" style="display: none;"></div>
            
            <div class="table-container">
                <h3>📅 Quarterly Goals</h3>
                <div id="quarterlyGoalsTable"></div>
            </div>
        </div>

        <!-- Weekly Goals Tab -->
        <div id="weekly-goals" class="tab-content">
            <h2>📆 Weekly Goals</h2>
            <form id="weeklyGoalForm">
                <div class="form-row">
                    <div class="form-group">
                        <label for="weeklyGoalTitle">Title *</label>
                        <input type="text" id="weeklyGoalTitle" required>
                    </div>
                    <div class="form-group">
                        <label for="weeklyGoalStartDate">Week Start Date *</label>
                        <input type="date" id="weeklyGoalStartDate" required>
                    </div>
                </div>
                
                <div class="form-group">
                    <label for="weeklyGoalDescription">Description</label>
                    <textarea id="weeklyGoalDescription"></textarea>
                </div>
                
                <div class="form-row">
                    <div class="form-group">
                        <label for="weeklyGoalMetrics">Key Metrics (comma-separated)</label>
                        <input type="text" id="weeklyGoalMetrics">
                    </div>
                    <div class="form-group">
                        <label for="weeklyGoalQuarterlyId">Quarterly Goal ID</label>
                        <input type="text" id="weeklyGoalQuarterlyId" placeholder="Optional">
                    </div>
                </div>
                
                <div class="form-group">
                    <label for="weeklyGoalUserId">User ID *</label>
                    <input type="text" id="weeklyGoalUserId" value="test-user-ui" required>
                </div>
                
                <button type="submit">Create Weekly Goal</button>
                <button type="button" class="btn-secondary" onclick="loadWeeklyGoals()">Load Goals</button>
                <button type="button" class="btn-secondary" onclick="clearForm('weeklyGoalForm')">Clear</button>
            </form>
            
            <div id="weeklyGoalResult" class="result" style="display: none;"></div>
            
            <div class="table-container">
                <h3>📋 Weekly Goals</h3>
                <div id="weeklyGoalsTable"></div>
            </div>
        </div>

        <!-- Habits Tab -->
        <div id="habits" class="tab-content">
            <h2>🔄 Habits</h2>
            <form id="habitForm">
                <div class="form-row">
                    <div class="form-group">
                        <label for="habitTitle">Title *</label>
                        <input type="text" id="habitTitle" required>
                    </div>
                    <div class="form-group">
                        <label for="habitFrequency">Frequency *</label>
                        <select id="habitFrequency" required>
                            <option value="daily">Daily</option>
                            <option value="weekly">Weekly</option>
                            <option value="monthly">Monthly</option>
                            <option value="custom">Custom</option>
                        </select>
                    </div>
                </div>
                
                <div class="form-group">
                    <label for="habitDescription">Description</label>
                    <textarea id="habitDescription"></textarea>
                </div>
                
                <div class="form-row">
                    <div class="form-group">
                        <label for="habitTargetCount">Target Count</label>
                        <input type="number" id="habitTargetCount" value="1" min="1">
                    </div>
                    <div class="form-group">
                        <label for="habitReminderTime">Reminder Time (HH:MM)</label>
                        <input type="time" id="habitReminderTime">
                    </div>
                </div>
                
                <div class="form-group">
                    <label for="habitTags">Tags (comma-separated)</label>
                    <input type="text" id="habitTags" placeholder="health, productivity, learning">
                </div>
                
                <div class="form-group">
                    <label for="habitUserId">User ID *</label>
                    <input type="text" id="habitUserId" value="test-user-ui" required>
                </div>
                
                <button type="submit">Create Habit</button>
                <button type="button" class="btn-secondary" onclick="clearForm('habitForm')">Clear</button>
            </form>
            
                <button type="submit">Create Habit</button>
                <button type="button" class="btn-secondary" onclick="loadHabits()">Load Habits</button>
                <button type="button" class="btn-secondary" onclick="clearForm('habitForm')">Clear</button>
            </form>
            
            <div id="habitResult" class="result" style="display: none;"></div>
            
            <div class="table-container">
                <h3>🔄 Habits</h3>
                <div id="habitsTable"></div>
            </div>
        </div>

        <!-- Projects Tab -->
        <div id="projects" class="tab-content">
            <h2>📂 Projects</h2>
            <form id="projectForm">
                <div class="form-row">
                    <div class="form-group">
                        <label for="projectTitle">Title *</label>
                        <input type="text" id="projectTitle" required>
                    </div>
                    <div class="form-group">
                        <label for="projectPriority">Priority</label>
                        <select id="projectPriority">
                            <option value="low">Low</option>
                            <option value="medium" selected>Medium</option>
                            <option value="high">High</option>
                            <option value="urgent">Urgent</option>
                        </select>
                    </div>
                </div>
                
                <div class="form-group">
                    <label for="projectDescription">Description</label>
                    <textarea id="projectDescription"></textarea>
                </div>
                
                <div class="form-row">
                    <div class="form-group">
                        <label for="projectStartDate">Start Date</label>
                        <input type="date" id="projectStartDate">
                    </div>
                    <div class="form-group">
                        <label for="projectEndDate">End Date</label>
                        <input type="date" id="projectEndDate">
                    </div>
                </div>
                
                <div class="form-row">
                    <div class="form-group">
                        <label for="projectYearlyGoalId">Yearly Goal ID</label>
                        <input type="text" id="projectYearlyGoalId" placeholder="Optional">
                    </div>
                    <div class="form-group">
                        <label for="projectQuarterlyGoalId">Quarterly Goal ID</label>
                        <input type="text" id="projectQuarterlyGoalId" placeholder="Optional">
                    </div>
                </div>
                
                <div class="form-group">
                    <label for="projectTags">Tags (comma-separated)</label>
                    <input type="text" id="projectTags" placeholder="web, mobile, api">
                </div>
                
                <div class="form-group">
                    <label for="projectUserId">User ID *</label>
                    <input type="text" id="projectUserId" value="test-user-ui" required>
                </div>
                
                <button type="submit">Create Project</button>
                <button type="button" class="btn-secondary" onclick="clearForm('projectForm')">Clear</button>
            </form>
            
                <button type="submit">Create Project</button>
                <button type="button" class="btn-secondary" onclick="loadProjects()">Load Projects</button>
                <button type="button" class="btn-secondary" onclick="clearForm('projectForm')">Clear</button>
            </form>
            
            <div id="projectResult" class="result" style="display: none;"></div>
            
            <div class="table-container">
                <h3>📁 Projects</h3>
                <div id="projectsTable"></div>
            </div>
        </div>
    </div>

    <script>
        const API_BASE_URL = 'http://localhost:7071/api';
        
        // State management
        let currentEditingTask = null;
        let allProjects = [];
        let allYearlyGoals = [];
        let allQuarterlyGoals = [];
        let allWeeklyGoals = [];
        let allHabits = [];
        
        // Tab functionality
        function showTab(tabName) {
            document.querySelectorAll('.tab').forEach(tab => tab.classList.remove('active'));
            document.querySelectorAll('.tab-content').forEach(content => content.classList.remove('active'));
            
            document.querySelector(`[onclick="showTab('${tabName}')"]`).classList.add('active');
            document.getElementById(tabName).classList.add('active');
            
            // Load data when switching tabs
            loadDataForTab(tabName);
        }
        
        function loadDataForTab(tabName) {
            switch(tabName) {
                case 'tasks':
                    loadTasks();
                    loadDropdownData();
                    break;
                case 'yearly-goals':
                    loadYearlyGoals();
                    break;
                case 'quarterly-goals':
                    loadQuarterlyGoals();
                    loadYearlyGoalsDropdown();
                    break;
                case 'weekly-goals':
                    loadWeeklyGoals();
                    loadQuarterlyGoalsDropdown();
                    break;
                case 'habits':
                    loadHabits();
                    break;
                case 'projects':
                    loadProjects();
                    loadGoalsDropdowns();
                    break;
            }
        }
        
        // API Status Check
        async function checkAPIStatus() {
            try {
                const response = await fetch(`${API_BASE_URL}/health`);
                if (response.ok) {
                    document.getElementById('apiStatus').className = 'api-status online';
                    document.getElementById('apiStatus').textContent = 'API Online';
                } else {
                    throw new Error('API not responding');
                }
            } catch (error) {
                document.getElementById('apiStatus').className = 'api-status offline';
                document.getElementById('apiStatus').textContent = 'API Offline';
            }
        }
        
        // Utility Functions
        function parseTagsAndMetrics(value) {
            return value ? value.split(',').map(tag => tag.trim()).filter(tag => tag) : [];
        }
        
        function showResult(elementId, message, isError = false) {
            const element = document.getElementById(elementId);
            element.textContent = message;
            element.className = `result ${isError ? 'error' : 'success'}`;
            element.style.display = 'block';
            setTimeout(() => element.style.display = 'none', 5000);
        }
        
        function clearForm(formId) {
            document.getElementById(formId).reset();
            if (formId === 'taskForm') {
                document.getElementById('taskUserId').value = 'test-user-ui';
            } else {
                // Reset user IDs for other forms
                const userIdField = document.querySelector(`#${formId} input[id$="UserId"]`);
                if (userIdField) userIdField.value = 'test-user-ui';
            }
        }
        
        function formatDate(dateString) {
            if (!dateString) return 'N/A';
            return new Date(dateString).toLocaleDateString();
        }
        
        function formatDateTime(dateString) {
            if (!dateString) return 'N/A';
            return new Date(dateString).toLocaleString();
        }
        
        // Dropdown population functions
        async function loadDropdownData() {
            await Promise.all([
                loadProjectsDropdown(),
                loadWeeklyGoalsDropdown(),
                loadHabitsDropdown()
            ]);
        }
        
        async function loadProjectsDropdown() {
            try {
                const response = await fetch(`${API_BASE_URL}/projects?user_id=test-user-ui`);
                allProjects = await response.json();
                
                const dropdown = document.getElementById('taskProjectId');
                dropdown.innerHTML = '<option value="">No Project</option>';
                allProjects.forEach(project => {
                    dropdown.innerHTML += `<option value="${project.id}">${project.title}</option>`;
                });
            } catch (error) {
                console.error('Error loading projects:', error);
            }
        }
        
        async function loadWeeklyGoalsDropdown() {
            try {
                const response = await fetch(`${API_BASE_URL}/weekly-goals?user_id=test-user-ui`);
                allWeeklyGoals = await response.json();
                
                const dropdown = document.getElementById('taskWeeklyGoalId');
                dropdown.innerHTML = '<option value="">No Weekly Goal</option>';
                allWeeklyGoals.forEach(goal => {
                    dropdown.innerHTML += `<option value="${goal.id}">${goal.title}</option>`;
                });
            } catch (error) {
                console.error('Error loading weekly goals:', error);
            }
        }
        
        async function loadHabitsDropdown() {
            try {
                const response = await fetch(`${API_BASE_URL}/habits?user_id=test-user-ui`);
                allHabits = await response.json();
                
                const dropdown = document.getElementById('taskHabitId');
                dropdown.innerHTML = '<option value="">No Habit</option>';
                allHabits.forEach(habit => {
                    dropdown.innerHTML += `<option value="${habit.id}">${habit.title}</option>`;
                });
            } catch (error) {
                console.error('Error loading habits:', error);
            }
        }
        
        async function loadYearlyGoalsDropdown() {
            try {
                const response = await fetch(`${API_BASE_URL}/yearly-goals?user_id=test-user-ui`);
                allYearlyGoals = await response.json();
                
                const dropdown = document.getElementById('quarterlyGoalYearlyId');
                dropdown.innerHTML = '<option value="">No Yearly Goal</option>';
                allYearlyGoals.forEach(goal => {
                    dropdown.innerHTML += `<option value="${goal.id}">${goal.title} (${goal.target_year})</option>`;
                });
            } catch (error) {
                console.error('Error loading yearly goals:', error);
            }
        }
        
        async function loadQuarterlyGoalsDropdown() {
            try {
                const response = await fetch(`${API_BASE_URL}/quarterly-goals?user_id=test-user-ui`);
                allQuarterlyGoals = await response.json();
                
                const dropdown = document.getElementById('weeklyGoalQuarterlyId');
                dropdown.innerHTML = '<option value="">No Quarterly Goal</option>';
                allQuarterlyGoals.forEach(goal => {
                    dropdown.innerHTML += `<option value="${goal.id}">${goal.title} (${goal.target_year} Q${goal.target_quarter})</option>`;
                });
            } catch (error) {
                console.error('Error loading quarterly goals:', error);
            }
        }
        
        async function loadGoalsDropdowns() {
            await Promise.all([
                loadYearlyGoalsDropdown(),
                loadQuarterlyGoalsDropdown()
            ]);
            
            // Update project form dropdowns
            const yearlyDropdown = document.getElementById('projectYearlyGoalId');
            yearlyDropdown.innerHTML = '<option value="">No Yearly Goal</option>';
            allYearlyGoals.forEach(goal => {
                yearlyDropdown.innerHTML += `<option value="${goal.id}">${goal.title} (${goal.target_year})</option>`;
            });
            
            const quarterlyDropdown = document.getElementById('projectQuarterlyGoalId');
            quarterlyDropdown.innerHTML = '<option value="">No Quarterly Goal</option>';
            allQuarterlyGoals.forEach(goal => {
                quarterlyDropdown.innerHTML += `<option value="${goal.id}">${goal.title} (${goal.target_year} Q${goal.target_quarter})</option>`;
            });
        }
        
        // CRUD Functions for Tasks
        async function loadTasks() {
            const userId = document.getElementById('taskUserId').value;
            if (!userId) return;
            
            try {
                const response = await fetch(`${API_BASE_URL}/tasks?user_id=${userId}`);
                const tasks = await response.json();
                displayTasksTable(tasks);
            } catch (error) {
                document.getElementById('tasksTable').innerHTML = `<div class="empty-state">Error loading tasks: ${error.message}</div>`;
            }
        }
        
        function displayTasksTable(tasks) {
            const container = document.getElementById('tasksTable');
            
            if (tasks.length === 0) {
                container.innerHTML = '<div class="empty-state">No tasks found</div>';
                return;
            }
            
            const table = `
                <table>
                    <thead>
                        <tr>
                            <th>Title</th>
                            <th>Status</th>
                            <th>Priority</th>
                            <th>Due Date</th>
                            <th>Project</th>
                            <th>Actions</th>
                        </tr>
                    </thead>
                    <tbody>
                        ${tasks.map(task => `
                            <tr>
                                <td>${task.title}</td>
                                <td>${task.status}</td>
                                <td>${task.priority}</td>
                                <td>${formatDate(task.due_date)}</td>
                                <td>${getProjectName(task.project_id)}</td>
                                <td>
                                    <button class="btn-edit" onclick="editTask('${task.id}')">Edit</button>
                                    <button class="btn-delete" onclick="deleteTask('${task.id}')">Delete</button>
                                </td>
                            </tr>
                        `).join('')}
                    </tbody>
                </table>
            `;
            
            container.innerHTML = table;
        }
        
        function getProjectName(projectId) {
            if (!projectId) return 'No Project';
            const project = allProjects.find(p => p.id === projectId);
            return project ? project.title : projectId;
        }
        
        async function deleteTask(taskId) {
            if (!confirm('Are you sure you want to delete this task?')) return;
            
            try {
                const response = await fetch(`${API_BASE_URL}/tasks/${taskId}`, {
                    method: 'DELETE'
                });
                
                if (response.ok) {
                    showResult('taskResult', '✅ Task deleted successfully!');
                    loadTasks();
                } else {
                    const error = await response.json();
                    showResult('taskResult', `❌ Error: ${error.error}`, true);
                }
            } catch (error) {
                showResult('taskResult', `❌ Network error: ${error.message}`, true);
            }
        }
        
        function editTask(taskId) {
            showResult('taskResult', `Edit functionality for task ${taskId} - Feature coming soon!`);
        }
        
        // CRUD Functions for Yearly Goals
        async function loadYearlyGoals() {
            const userId = 'test-user-ui';
            
            try {
                const response = await fetch(`${API_BASE_URL}/yearly-goals?user_id=${userId}`);
                const goals = await response.json();
                displayYearlyGoalsTable(goals);
            } catch (error) {
                document.getElementById('yearlyGoalsTable').innerHTML = `<div class="empty-state">Error loading yearly goals: ${error.message}</div>`;
            }
        }
        
        function displayYearlyGoalsTable(goals) {
            const container = document.getElementById('yearlyGoalsTable');
            
            if (goals.length === 0) {
                container.innerHTML = '<div class="empty-state">No yearly goals found</div>';
                return;
            }
            
            const table = `
                <table>
                    <thead>
                        <tr>
                            <th>Title</th>
                            <th>Year</th>
                            <th>Description</th>
                            <th>Key Metrics</th>
                            <th>Actions</th>
                        </tr>
                    </thead>
                    <tbody>
                        ${goals.map(goal => `
                            <tr>
                                <td>${goal.title}</td>
                                <td>${goal.target_year}</td>
                                <td>${goal.description || 'N/A'}</td>
                                <td>${goal.key_metrics ? goal.key_metrics.join(', ') : 'N/A'}</td>
                                <td>
                                    <button class="btn-delete" onclick="deleteYearlyGoal('${goal.id}')">Delete</button>
                                </td>
                            </tr>
                        `).join('')}
                    </tbody>
                </table>
            `;
            
            container.innerHTML = table;
        }
        
        async function deleteYearlyGoal(goalId) {
            if (!confirm('Are you sure you want to delete this yearly goal?')) return;
            
            try {
                const response = await fetch(`${API_BASE_URL}/yearly-goals/${goalId}`, {
                    method: 'DELETE'
                });
                
                if (response.ok) {
                    showResult('yearlyGoalResult', '✅ Yearly goal deleted successfully!');
                    loadYearlyGoals();
                } else {
                    const error = await response.json();
                    showResult('yearlyGoalResult', `❌ Error: ${error.error}`, true);
                }
            } catch (error) {
                showResult('yearlyGoalResult', `❌ Network error: ${error.message}`, true);
            }
        }
        
        // CRUD Functions for Quarterly Goals
        async function loadQuarterlyGoals() {
            const userId = 'test-user-ui';
            
            try {
                const response = await fetch(`${API_BASE_URL}/quarterly-goals?user_id=${userId}`);
                const goals = await response.json();
                displayQuarterlyGoalsTable(goals);
            } catch (error) {
                document.getElementById('quarterlyGoalsTable').innerHTML = `<div class="empty-state">Error loading quarterly goals: ${error.message}</div>`;
            }
        }
        
        function displayQuarterlyGoalsTable(goals) {
            const container = document.getElementById('quarterlyGoalsTable');
            
            if (goals.length === 0) {
                container.innerHTML = '<div class="empty-state">No quarterly goals found</div>';
                return;
            }
            
            const table = `
                <table>
                    <thead>
                        <tr>
                            <th>Title</th>
                            <th>Year</th>
                            <th>Quarter</th>
                            <th>Description</th>
                            <th>Actions</th>
                        </tr>
                    </thead>
                    <tbody>
                        ${goals.map(goal => `
                            <tr>
                                <td>${goal.title}</td>
                                <td>${goal.target_year}</td>
                                <td>Q${goal.target_quarter}</td>
                                <td>${goal.description || 'N/A'}</td>
                                <td>
                                    <button class="btn-delete" onclick="deleteQuarterlyGoal('${goal.id}')">Delete</button>
                                </td>
                            </tr>
                        `).join('')}
                    </tbody>
                </table>
            `;
            
            container.innerHTML = table;
        }
        
        async function deleteQuarterlyGoal(goalId) {
            if (!confirm('Are you sure you want to delete this quarterly goal?')) return;
            
            try {
                const response = await fetch(`${API_BASE_URL}/quarterly-goals/${goalId}`, {
                    method: 'DELETE'
                });
                
                if (response.ok) {
                    showResult('quarterlyGoalResult', '✅ Quarterly goal deleted successfully!');
                    loadQuarterlyGoals();
                } else {
                    const error = await response.json();
                    showResult('quarterlyGoalResult', `❌ Error: ${error.error}`, true);
                }
            } catch (error) {
                showResult('quarterlyGoalResult', `❌ Network error: ${error.message}`, true);
            }
        }
        
        // CRUD Functions for Weekly Goals
        async function loadWeeklyGoals() {
            const userId = 'test-user-ui';
            
            try {
                const response = await fetch(`${API_BASE_URL}/weekly-goals?user_id=${userId}`);
                const goals = await response.json();
                displayWeeklyGoalsTable(goals);
            } catch (error) {
                document.getElementById('weeklyGoalsTable').innerHTML = `<div class="empty-state">Error loading weekly goals: ${error.message}</div>`;
            }
        }
        
        function displayWeeklyGoalsTable(goals) {
            const container = document.getElementById('weeklyGoalsTable');
            
            if (goals.length === 0) {
                container.innerHTML = '<div class="empty-state">No weekly goals found</div>';
                return;
            }
            
            const table = `
                <table>
                    <thead>
                        <tr>
                            <th>Title</th>
                            <th>Week Start</th>
                            <th>Description</th>
                            <th>Actions</th>
                        </tr>
                    </thead>
                    <tbody>
                        ${goals.map(goal => `
                            <tr>
                                <td>${goal.title}</td>
                                <td>${formatDate(goal.week_start_date)}</td>
                                <td>${goal.description || 'N/A'}</td>
                                <td>
                                    <button class="btn-delete" onclick="deleteWeeklyGoal('${goal.id}')">Delete</button>
                                </td>
                            </tr>
                        `).join('')}
                    </tbody>
                </table>
            `;
            
            container.innerHTML = table;
        }
        
        async function deleteWeeklyGoal(goalId) {
            if (!confirm('Are you sure you want to delete this weekly goal?')) return;
            
            try {
                const response = await fetch(`${API_BASE_URL}/weekly-goals/${goalId}`, {
                    method: 'DELETE'
                });
                
                if (response.ok) {
                    showResult('weeklyGoalResult', '✅ Weekly goal deleted successfully!');
                    loadWeeklyGoals();
                } else {
                    const error = await response.json();
                    showResult('weeklyGoalResult', `❌ Error: ${error.error}`, true);
                }
            } catch (error) {
                showResult('weeklyGoalResult', `❌ Network error: ${error.message}`, true);
            }
        }
        
        // CRUD Functions for Habits
        async function loadHabits() {
            const userId = 'test-user-ui';
            
            try {
                const response = await fetch(`${API_BASE_URL}/habits?user_id=${userId}`);
                const habits = await response.json();
                displayHabitsTable(habits);
            } catch (error) {
                document.getElementById('habitsTable').innerHTML = `<div class="empty-state">Error loading habits: ${error.message}</div>`;
            }
        }
        
        function displayHabitsTable(habits) {
            const container = document.getElementById('habitsTable');
            
            if (habits.length === 0) {
                container.innerHTML = '<div class="empty-state">No habits found</div>';
                return;
            }
            
            const table = `
                <table>
                    <thead>
                        <tr>
                            <th>Title</th>
                            <th>Frequency</th>
                            <th>Target Count</th>
                            <th>Current Streak</th>
                            <th>Actions</th>
                        </tr>
                    </thead>
                    <tbody>
                        ${habits.map(habit => `
                            <tr>
                                <td>${habit.title}</td>
                                <td>${habit.frequency}</td>
                                <td>${habit.target_count}</td>
                                <td>${habit.current_streak || 0}</td>
                                <td>
                                    <button class="btn-delete" onclick="deleteHabit('${habit.id}')">Delete</button>
                                </td>
                            </tr>
                        `).join('')}
                    </tbody>
                </table>
            `;
            
            container.innerHTML = table;
        }
        
        async function deleteHabit(habitId) {
            if (!confirm('Are you sure you want to delete this habit?')) return;
            
            try {
                const response = await fetch(`${API_BASE_URL}/habits/${habitId}`, {
                    method: 'DELETE'
                });
                
                if (response.ok) {
                    showResult('habitResult', '✅ Habit deleted successfully!');
                    loadHabits();
                } else {
                    const error = await response.json();
                    showResult('habitResult', `❌ Error: ${error.error}`, true);
                }
            } catch (error) {
                showResult('habitResult', `❌ Network error: ${error.message}`, true);
            }
        }
        
        // CRUD Functions for Projects
        async function loadProjects() {
            const userId = 'test-user-ui';
            
            try {
                const response = await fetch(`${API_BASE_URL}/projects?user_id=${userId}`);
                const projects = await response.json();
                displayProjectsTable(projects);
            } catch (error) {
                document.getElementById('projectsTable').innerHTML = `<div class="empty-state">Error loading projects: ${error.message}</div>`;
            }
        }
        
        function displayProjectsTable(projects) {
            const container = document.getElementById('projectsTable');
            
            if (projects.length === 0) {
                container.innerHTML = '<div class="empty-state">No projects found</div>';
                return;
            }
            
            const table = `
                <table>
                    <thead>
                        <tr>
                            <th>Title</th>
                            <th>Priority</th>
                            <th>Start Date</th>
                            <th>End Date</th>
                            <th>Status</th>
                            <th>Actions</th>
                        </tr>
                    </thead>
                    <tbody>
                        ${projects.map(project => `
                            <tr>
                                <td>${project.title}</td>
                                <td>${project.priority}</td>
                                <td>${formatDate(project.start_date)}</td>
                                <td>${formatDate(project.end_date)}</td>
                                <td>${project.status}</td>
                                <td>
                                    <button class="btn-delete" onclick="deleteProject('${project.id}')">Delete</button>
                                </td>
                            </tr>
                        `).join('')}
                    </tbody>
                </table>
            `;
            
            container.innerHTML = table;
        }
        
        async function deleteProject(projectId) {
            if (!confirm('Are you sure you want to delete this project?')) return;
            
            try {
                const response = await fetch(`${API_BASE_URL}/projects/${projectId}`, {
                    method: 'DELETE'
                });
                
                if (response.ok) {
                    showResult('projectResult', '✅ Project deleted successfully!');
                    loadProjects();
                } else {
                    const error = await response.json();
                    showResult('projectResult', `❌ Error: ${error.error}`, true);
                }
            } catch (error) {
                showResult('projectResult', `❌ Network error: ${error.message}`, true);
            }
        }
        
        // Form Handlers
        document.getElementById('taskForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            
            const taskData = {
                title: document.getElementById('taskTitle').value,
                description: document.getElementById('taskDescription').value || null,
                status: document.getElementById('taskStatus').value,
                priority: document.getElementById('taskPriority').value,
                due_date: document.getElementById('taskDueDate').value || null,
                estimated_hours: parseFloat(document.getElementById('taskEstimatedHours').value) || null,
                project_id: document.getElementById('taskProjectId').value || null,
                weekly_goal_id: document.getElementById('taskWeeklyGoalId').value || null,
                habit_id: document.getElementById('taskHabitId').value || null,
                tags: parseTagsAndMetrics(document.getElementById('taskTags').value),
                user_id: document.getElementById('taskUserId').value
            };
            
            try {
                const response = await fetch(`${API_BASE_URL}/tasks`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(taskData)
                });
                
                const result = await response.json();
                
                if (response.ok) {
                    showResult('taskResult', `✅ Task created successfully!`);
                    clearForm('taskForm');
                    loadTasks();
                } else {
                    showResult('taskResult', `❌ Error: ${result.error || 'Unknown error'}`, true);
                }
            } catch (error) {
                showResult('taskResult', `❌ Network error: ${error.message}`, true);
            }
        });
        
        document.getElementById('yearlyGoalForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            
            const goalData = {
                title: document.getElementById('yearlyGoalTitle').value,
                description: document.getElementById('yearlyGoalDescription').value || null,
                target_year: parseInt(document.getElementById('yearlyGoalYear').value),
                key_metrics: parseTagsAndMetrics(document.getElementById('yearlyGoalMetrics').value),
                user_id: document.getElementById('yearlyGoalUserId').value
            };
            
            try {
                const response = await fetch(`${API_BASE_URL}/yearly-goals`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(goalData)
                });
                
                const result = await response.json();
                
                if (response.ok) {
                    showResult('yearlyGoalResult', `✅ Yearly goal created successfully!`);
                    clearForm('yearlyGoalForm');
                    loadYearlyGoals();
                } else {
                    showResult('yearlyGoalResult', `❌ Error: ${result.error || 'Unknown error'}`, true);
                }
            } catch (error) {
                showResult('yearlyGoalResult', `❌ Network error: ${error.message}`, true);
            }
        });
        
        document.getElementById('quarterlyGoalForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            
            const goalData = {
                title: document.getElementById('quarterlyGoalTitle').value,
                description: document.getElementById('quarterlyGoalDescription').value || null,
                target_year: parseInt(document.getElementById('quarterlyGoalYear').value),
                target_quarter: parseInt(document.getElementById('quarterlyGoalQuarter').value),
                key_metrics: parseTagsAndMetrics(document.getElementById('quarterlyGoalMetrics').value),
                yearly_goal_id: document.getElementById('quarterlyGoalYearlyId').value || null,
                user_id: document.getElementById('quarterlyGoalUserId').value
            };
            
            try {
                const response = await fetch(`${API_BASE_URL}/quarterly-goals`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(goalData)
                });
                
                const result = await response.json();
                
                if (response.ok) {
                    showResult('quarterlyGoalResult', `✅ Quarterly goal created successfully!`);
                    clearForm('quarterlyGoalForm');
                    loadQuarterlyGoals();
                } else {
                    showResult('quarterlyGoalResult', `❌ Error: ${result.error || 'Unknown error'}`, true);
                }
            } catch (error) {
                showResult('quarterlyGoalResult', `❌ Network error: ${error.message}`, true);
            }
        });
        
        document.getElementById('weeklyGoalForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            
            const goalData = {
                title: document.getElementById('weeklyGoalTitle').value,
                description: document.getElementById('weeklyGoalDescription').value || null,
                week_start_date: document.getElementById('weeklyGoalStartDate').value,
                key_metrics: parseTagsAndMetrics(document.getElementById('weeklyGoalMetrics').value),
                quarterly_goal_id: document.getElementById('weeklyGoalQuarterlyId').value || null,
                user_id: document.getElementById('weeklyGoalUserId').value
            };
            
            try {
                const response = await fetch(`${API_BASE_URL}/weekly-goals`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(goalData)
                });
                
                const result = await response.json();
                
                if (response.ok) {
                    showResult('weeklyGoalResult', `✅ Weekly goal created successfully!`);
                    clearForm('weeklyGoalForm');
                    loadWeeklyGoals();
                } else {
                    showResult('weeklyGoalResult', `❌ Error: ${result.error || 'Unknown error'}`, true);
                }
            } catch (error) {
                showResult('weeklyGoalResult', `❌ Network error: ${error.message}`, true);
            }
        });
        
        document.getElementById('habitForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            
            const habitData = {
                title: document.getElementById('habitTitle').value,
                description: document.getElementById('habitDescription').value || null,
                frequency: document.getElementById('habitFrequency').value,
                target_count: parseInt(document.getElementById('habitTargetCount').value),
                reminder_time: document.getElementById('habitReminderTime').value || null,
                tags: parseTagsAndMetrics(document.getElementById('habitTags').value),
                user_id: document.getElementById('habitUserId').value
            };
            
            try {
                const response = await fetch(`${API_BASE_URL}/habits`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(habitData)
                });
                
                const result = await response.json();
                
                if (response.ok) {
                    showResult('habitResult', `✅ Habit created successfully!`);
                    clearForm('habitForm');
                    loadHabits();
                } else {
                    showResult('habitResult', `❌ Error: ${result.error || 'Unknown error'}`, true);
                }
            } catch (error) {
                showResult('habitResult', `❌ Network error: ${error.message}`, true);
            }
        });
        
        document.getElementById('projectForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            
            const projectData = {
                title: document.getElementById('projectTitle').value,
                description: document.getElementById('projectDescription').value || null,
                priority: document.getElementById('projectPriority').value,
                start_date: document.getElementById('projectStartDate').value || null,
                end_date: document.getElementById('projectEndDate').value || null,
                yearly_goal_id: document.getElementById('projectYearlyGoalId').value || null,
                quarterly_goal_id: document.getElementById('projectQuarterlyGoalId').value || null,
                tags: parseTagsAndMetrics(document.getElementById('projectTags').value),
                user_id: document.getElementById('projectUserId').value
            };
            
            try {
                const response = await fetch(`${API_BASE_URL}/projects`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(projectData)
                });
                
                const result = await response.json();
                
                if (response.ok) {
                    showResult('projectResult', `✅ Project created successfully!`);
                    clearForm('projectForm');
                    loadProjects();
                } else {
                    showResult('projectResult', `❌ Error: ${result.error || 'Unknown error'}`, true);
                }
            } catch (error) {
                showResult('projectResult', `❌ Network error: ${error.message}`, true);
            }
        });
        
        // Initialize
        document.addEventListener('DOMContentLoaded', function() {
            // Set default date for weekly goals
            document.getElementById('weeklyGoalStartDate').value = new Date().toISOString().split('T')[0];
            
            // Check API status
            checkAPIStatus();
            
            // Load initial data for the default tab (tasks)
            loadDataForTab('tasks');
            
            // Set up periodic API status check
            setInterval(checkAPIStatus, 30000); // Check every 30 seconds
        });
    </script>
</body>
</html>
